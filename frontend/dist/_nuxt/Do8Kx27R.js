import{_ as N,A as R,r as f,B as $,m as i,o as V,c as A,b as n,w as d,d as v,x as C,a as _,C as T,F,z as j,n as z}from"./Bi-YAAcS.js";import{S as h}from"./DOYwHpwi.js";const U={class:"submit-buttons"},O={__name:"CategoryRegister",setup(w){const b=j(),x=R(),l=f(""),c=f(""),m=f(null),r=$({name:[],description:[],image:[]}),k=t=>{const e=[];return(!t||!t.trim())&&e.push("El nombre es requerido"),t.length<8&&e.push("El nombre debe tener al menos 8 caracteres"),t.length>255&&e.push("El nombre no puede exceder los 255 caracteres"),e},B=t=>{const e=[];return(!t||!t.trim())&&e.push("La descripción es requerida"),t.length<10&&e.push("La descripción debe tener entre 10 y 500 caracteres"),t.length>500&&e.push("La descripción no puede exceder los 500 caracteres"),e},S=t=>{const e=[];if(!t)return e.push("Debes seleccionar una imagen"),e;["image/jpeg","image/png","image/gif"].includes(t.type)||e.push("El archivo debe ser una imagen (jpeg, png, gif)");const a=5*1024*1024;return t.size>a&&e.push("La imagen no puede exceder los 5MB"),e},D=()=>{r.name=[],r.description=[],r.image=[];let t=!0;const e=k(l.value);e.length>0&&(r.name=e,t=!1);const s=B(c.value);s.length>0&&(r.description=s,t=!1);const a=S(m.value);return a.length>0&&(r.image=a,t=!1),t},I=async()=>{if(!D())return;const t=new FormData;t.append("name",l.value),t.append("description",c.value),t.append("image",m.value);try{const e=await fetch(`${b.public.API_BASE_URL}categories`,{method:"POST",body:t,headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok)h.fire({title:"Categoría registrada con éxito",icon:"success",confirmButtonText:"Aceptar"}),E();else if(e.status===409)r.name=["Esta categoría ya existe"];else if(e.status===400){const s=await e.json();s.errors?s.errors.forEach(a=>{const u=a.field,p=a.message;u==="name"&&r.name.push(p),u==="description"&&r.description.push(p),u==="image"&&r.image.push(p)}):r.description=["La descripción debe contener por lo menos 10 caracteres"]}else{const s=await e.text();throw new Error(s||"Error al registrar la categoría")}}catch(e){h.fire({title:"Error al registrar la categoría",icon:"error",text:e.message||"No se pudo registrar la categoría",confirmButtonText:"Aceptar"})}},E=()=>{for(const t of Object.keys(r))t==="image"?m.value=null:t==="name"?l.value="":t==="description"&&(c.value=""),r[t]=[]},g=t=>{r[t]=[]};return(t,e)=>{const s=i("v-icon"),a=i("v-text-field"),u=i("v-textarea"),p=i("v-file-input"),y=i("v-btn"),L=i("v-container");return V(),A(F,null,[n(s,{class:"exit-icon",onClick:e[0]||(e[0]=o=>C(x).back())},{default:d(()=>e[7]||(e[7]=[v("mdi-arrow-left")])),_:1}),n(L,{class:"form-container"},{default:d(()=>[e[10]||(e[10]=_("h1",{class:"form-title"},"Registrar categoría",-1)),_("form",{onSubmit:T(I,["prevent"])},[n(a,{class:"input",modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=o=>l.value=o),label:"Nombre","error-messages":r.name,onInput:e[2]||(e[2]=o=>g("name"))},null,8,["modelValue","error-messages"]),n(u,{class:"text-area",modelValue:c.value,"onUpdate:modelValue":e[3]||(e[3]=o=>c.value=o),label:"Descripción","error-messages":r.description,onInput:e[4]||(e[4]=o=>g("description"))},null,8,["modelValue","error-messages"]),n(p,{class:"file-input",modelValue:m.value,"onUpdate:modelValue":e[5]||(e[5]=o=>m.value=o),label:"Seleccionar imagen",accept:"image/*","error-messages":r.image,onChange:e[6]||(e[6]=o=>g("image"))},null,8,["modelValue","error-messages"]),_("div",U,[n(y,{class:"submit",type:"submit"},{default:d(()=>e[8]||(e[8]=[v("Enviar")])),_:1}),n(y,{onClick:E,class:"clean"},{default:d(()=>e[9]||(e[9]=[v("Limpiar")])),_:1})])],32)]),_:1})],64)}}},q=N(O,[["__scopeId","data-v-00ea6118"]]),G={__name:"register",setup(w){return(b,x)=>(V(),z(C(q)))}};export{G as default};
