import{_ as M,u as F,r as n,B as D,s as j,v as Q,m as v,o as C,c as G,b as i,w as y,d as P,x as N,a as _,C as J,F as Y,z as H,n as K}from"./DzSD3iaJ.js";import{S}from"./DOYwHpwi.js";import{u as b}from"./CSkv7lNe.js";const W={class:"submit-buttons"},X={__name:"SaleRegister",setup(A){const u=H(),E=F(),c=n(),d=n(),m=n(""),p=n(""),I=n([]),w=n([]),x=n(1),f=n(10),a=D({quantitySold:[],salePrice:[],selectedCategory:[],selectedProduct:[]}),B=()=>{const t=parseInt(c.value);return isNaN(t)?(a.quantitySold=["La cantidad debe ser un número entero válido"],!1):t<1?(a.quantitySold=["La cantidad debe ser mayor a 1"],!1):t>2e7?(a.quantitySold=["La cantidad no debe superar 20000000"],!1):!0},q=()=>{const t=parseInt(d.value);return isNaN(t)?(a.salePrice=["El precio debe ser un número entero válido"],!1):t<1e3?(a.salePrice=["El precio total debe ser mayor a 1000"],!1):t>2e7?(a.salePrice=["El precio no debe superar 20000000"],!1):!0},k=()=>{const t=parseInt(m.value);return isNaN(t)||t<1?(a.selectedCategory=["La categoría es requerida"],!1):!0},R=()=>{const t=parseInt(p.value);return isNaN(t)||t<1?(a.selectedProduct=["El producto es requerido"],!1):!0},L=()=>{for(const s in a)a.hasOwnProperty(s)&&(a[s]=[]);const t=k(),e=R(),r=B(),l=q();return t&&e&&r&&l},U=async()=>{if(!L())return;const t={quantitySold:c.value,salePrice:d.value,categoryId:m.value,productId:p.value};try{const e=await fetch(`${u.public.API_BASE_URL}sales`,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`}});if(e.ok)S.fire({text:"Venta registrada con exito",icon:"success",confirmButtonText:"Aceptar"}),V();else{const r=await e.text();throw new Error(r||"Error al registrar la venta")}}catch(e){S.fire({title:"Error al registrar la venta",text:e.message||"Error al registrar la venta",icon:"error",confirmButtonText:"Aceptar"})}},T=async()=>{const{data:t}=await b(`${u.public.API_BASE_URL}categories?page=1&pageSize=1`,"$lM1Y3btdOf"),e=t.value.totalItems;f.value=e;try{const{data:r,error:l}=await b(`${u.public.API_BASE_URL}categories?page=${x.value}&pageSize=${f.value}`,"$tmEfdPi5ME");if(!l.value)I.value=r.value.data.map(s=>({id:s.id,name:s.name}));else throw new Error(l.value.message)}catch(r){console.error("Error loading categories:",r),S.fire({title:"Error al cargar categorías",text:"No se han cargado las categorías",icon:"error",confirmButtonText:"Aceptar"})}},O=async()=>{const{data:t}=await b(`${u.public.API_BASE_URL}products?page=1&pageSize=1`,"$EjlbOOlU41"),e=t.value.totalItems;f.value=e;try{const{data:r,error:l}=await b(`${u.public.API_BASE_URL}products?page=${x.value}&pageSize=${f.value}`,"$r5fq6yNp3D");if(!l.value)w.value=r.value.data.map(s=>({id:s.id,name:s.name}));else throw new Error(l.value.message)}catch(r){console.error("Error loading categories:",r),S.fire({title:"Error al cargar los productos",text:"No se han podido cargar las productos",icon:"error",confirmButtonText:"Aceptar"})}};j(async()=>{await Q(),await T(),await O()});const V=()=>{for(const t of Object.keys(a))t==="quantitySold"?c.value=0:t==="salePrice"?d.value=0:t==="selectedCategory"?m.value="":t==="selectedProduct"&&(p.value=""),a[t]=[]},g=t=>{a[t]=[]};return(t,e)=>{const r=v("v-icon"),l=v("v-text-field"),s=v("v-autocomplete"),$=v("v-btn"),z=v("v-container");return C(),G(Y,null,[i(r,{class:"exit-icon",onClick:e[0]||(e[0]=o=>N(E).back())},{default:y(()=>e[9]||(e[9]=[P("mdi-arrow-left")])),_:1}),i(z,{class:"form-container"},{default:y(()=>[e[12]||(e[12]=_("h1",{class:"form-title"},"Registro de ventas",-1)),_("form",{style:{"margin-top":"5%"},onSubmit:J(U,["prevent"])},[i(l,{class:"input",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=o=>c.value=o),modelModifiers:{number:!0},label:"Cantidad","error-messages":a.quantitySold,onInput:e[2]||(e[2]=o=>g("quantitySold")),type:"number"},null,8,["modelValue","error-messages"]),i(l,{class:"input",modelValue:d.value,"onUpdate:modelValue":e[3]||(e[3]=o=>d.value=o),modelModifiers:{number:!0},label:"Total","error-messages":a.salePrice,onInput:e[4]||(e[4]=o=>g("salePrice")),type:"number"},null,8,["modelValue","error-messages"]),i(s,{class:"select",modelValue:m.value,"onUpdate:modelValue":[e[5]||(e[5]=o=>m.value=o),e[6]||(e[6]=o=>g("selectedCategory"))],modelModifiers:{number:!0},items:I.value,"item-title":"name","item-value":"id",label:"Seleccionar Categoría","error-messages":a.selectedCategory},null,8,["modelValue","items","error-messages"]),i(s,{class:"select",modelValue:p.value,"onUpdate:modelValue":[e[7]||(e[7]=o=>p.value=o),e[8]||(e[8]=o=>g("selectedProduct"))],items:w.value,"item-title":"name","item-value":"id",label:"Seleccionar Producto","error-messages":a.selectedProduct},null,8,["modelValue","items","error-messages"]),_("div",W,[i($,{class:"submit",type:"submit"},{default:y(()=>e[10]||(e[10]=[P("Enviar")])),_:1}),i($,{class:"clean",onClick:V},{default:y(()=>e[11]||(e[11]=[P("Limpiar")])),_:1})])],32)]),_:1})],64)}}},Z=M(X,[["__scopeId","data-v-c009fdff"]]),ae={__name:"register",setup(A){return(u,E)=>(C(),K(N(Z)))}};export{ae as default};
