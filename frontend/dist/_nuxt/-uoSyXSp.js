import{_ as se}from"./CL3q9ate.js";import{r as i,m as n,o as g,c as C,b as t,w as a,d,F as S,z as j,_ as re,A as ie,s as ce,v as R,g as I,a as u,C as ue,y as de,n as q,D as ve,t as F,G as T,x as _e}from"./DkewYONJ.js";import{d as ge}from"./CVGRC5-7.js";import{C as me}from"./BZ--1lOb.js";import{S as z}from"./DOYwHpwi.js";import{u as G}from"./DUKX-aPY.js";import{L as fe}from"./Cz6vfwWj.js";const pe={__name:"CategoryDelete",props:{category:Object},emits:["deleted"],setup($,{emit:w}){const k=j(),m=$,f=w,p=i({...m.category}),x=async()=>{try{await G(`${k.public.API_BASE_URL}categories/${m.category.id}`,{method:"DELETE"},"$o02dgv0U7J")!=null?(z.fire({title:"Eliminado",text:"Categoría eliminada correctamente",icon:"success",confirmButtonText:"Aceptar"}),f("deleted",p.value.id)):(z.fire({title:"Error",text:"No se pudo eliminar la categoría",icon:"error",confirmButtonText:"Aceptar"}),f("deleted",!1,null))}catch(v){console.log("Error",v)}};return(v,s)=>{const y=n("v-card-title"),E=n("v-card-text"),V=n("v-btn"),b=n("v-card-actions");return g(),C(S,null,[t(y,{class:"headline"},{default:a(()=>s[0]||(s[0]=[d("Eliminar categoría")])),_:1}),t(E,null,{default:a(()=>s[1]||(s[1]=[d("¿Estás seguro que quieres eliminar esta categoría?")])),_:1}),t(b,null,{default:a(()=>[t(V,{color:"green darken-1",text:"",onClick:x},{default:a(()=>s[2]||(s[2]=[d("Si, eliminar")])),_:1})]),_:1})],64)}}},ye={class:"header-container"},xe={key:0,style:{"text-align":"center"}},Ce={key:1,class:"category-container"},we=["src"],be={class:"category-info"},ke={class:"text-center"},Ee={__name:"InterfazUser",setup($){const w=j(),k=ie(),m=i(!1),f=i(""),p=i(!1),x=i(1),v=i(10),s=i(!1),y=i(!1),E=i(null),V=i(null),b=i([]),r=i({data:[],totalPages:1}),_=async()=>{m.value=!0;try{const{data:o}=await G(`${w.public.API_BASE_URL}categories?page=${x.value}&pageSize=${v.value}`,"$CbwfwtgAsP");if(o.value)b.value=o.value.data,r.value=o.value;else throw new Error("No se recibieron datos válidos")}catch(o){console.error("Error fetching categories:",o),r.value={data:[],totalPages:1}}finally{m.value=!1}},O=o=>o;ce(async()=>{await R(),await _()});const M=ge(async o=>{if(await _(),!o.trim()){r.value={data:b.value,totalPages:r.value.totalPages},p.value=b.value.length===0;return}try{const c=await(await fetch(`${w.public.API_BASE_URL}categories/search?query=${encodeURIComponent(o.trim())}`)).json();r.value={data:c,totalPages:1},p.value=c.length===0}catch(e){console.error("Error fetching filtered categories:",e),r.value={data:[],totalPages:1},p.value=!0}},500);I(f,o=>{M(o)}),I(x,async()=>{await _()}),I(v,async()=>{await _()});const J=o=>{o&&o.id?(E.value={...o},s.value=!0):console.error("La categoría no tiene una propiedad id válida.")},H=async o=>{if(o){const e=r.value.data.findIndex(c=>c.id===o.id);e!==-1&&(r.value.data[e]=o)}await _(),s.value=!1},K=async o=>{const e=r.value.data.findIndex(c=>c.id===o);e!==-1&&r.value.data.splice(e,1),await _(),y.value=!1},Q=async()=>{await R(),await k.push("/categories/register")},W=async o=>{V.value=o,y.value=!0},X=()=>{f.value="",p.value=!1};return(o,e)=>{const c=n("v-btn"),Y=n("v-text-field"),Z=n("v-select"),ee=n("v-alert"),te=se,D=n("v-icon"),A=n("v-tooltip"),ae=n("v-pagination"),P=n("v-container"),oe=n("v-col"),le=n("v-row"),B=n("v-card-text"),h=n("v-card-actions"),L=n("v-card"),N=n("v-dialog");return g(),C(S,null,[u("div",null,[u("div",ye,[t(c,{onClick:ue(Q,["prevent"]),class:"register-button"},{default:a(()=>e[7]||(e[7]=[d("Registrar categoría")])),_:1}),t(Y,{class:"search-field",modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),density:"comfortable",placeholder:"Buscar categorías","prepend-inner-icon":"mdi-magnify",variant:"solo",clearable:"","hide-details":"","onClick:clear":X},null,8,["modelValue"])]),t(Z,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value=l),class:"page-select",items:[10,20,30,40,50],label:"Seleccionar categorías por página",onChange:_},null,8,["modelValue"]),!m.value&&p.value?(g(),C("div",xe,[t(ee,{color:"#009c8c",type:"warning"},{default:a(()=>e[8]||(e[8]=[d(" No se encontraron registros. ")])),_:1})])):(g(),C("div",Ce,[(g(!0),C(S,null,de(r.value.data||[],l=>(g(),C("div",{class:"category-item",key:l.id},[u("div",null,[u("img",{class:"category-image",src:O(l.imagePath)},null,8,we)]),t(te,{to:`/categories/${l.id}`},{default:a(()=>[u("button",be,[u("h3",null,F(l.name),1),u("p",null,F(l.description),1)])]),_:2},1032,["to"]),t(A,{text:"Editar"},{activator:a(({props:U})=>[t(D,T({ref_for:!0},U,{onClick:ne=>J(l),style:{color:"rgba(228, 192, 11, 0.663)"}}),{default:a(()=>e[9]||(e[9]=[d(" mdi-pencil ")])),_:2},1040,["onClick"])]),_:2},1024),t(A,{text:"Eliminar"},{activator:a(({props:U})=>[t(D,T({ref_for:!0},U,{onClick:ne=>W(l),style:{color:"darkslategrey"}}),{default:a(()=>e[10]||(e[10]=[d(" mdi-delete ")])),_:2},1040,["onClick"])]),_:2},1024)]))),128))])),u("div",ke,[t(P,null,{default:a(()=>[t(le,{justify:"center"},{default:a(()=>[t(oe,{cols:"8"},{default:a(()=>[t(P,{class:"max-width"},{default:a(()=>[t(ae,{modelValue:x.value,"onUpdate:modelValue":e[2]||(e[2]=l=>x.value=l),length:r.value.totalPages||1,class:"my-4",onInput:_},null,8,["modelValue","length"])]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"dialog",modelValue:s.value,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value=l)},{default:a(()=>[t(L,null,{default:a(()=>[e[12]||(e[12]=u("h1",{class:"dialog-title"},"Editar Categoría",-1)),t(B,null,{default:a(()=>[t(me,{category:E.value,onSave:H},null,8,["category"])]),_:1}),t(h,null,{default:a(()=>[t(c,{class:"cancel-button",text:"",onClick:e[3]||(e[3]=l=>s.value=!1)},{default:a(()=>e[11]||(e[11]=[d("Cancelar")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(N,{class:"dialog",modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=l=>y.value=l)},{default:a(()=>[t(L,null,{default:a(()=>[t(B,null,{default:a(()=>[t(pe,{category:V.value,onDeleted:K},null,8,["category"])]),_:1}),t(h,null,{default:a(()=>[t(c,{color:"blue darken-1",text:"",onClick:e[5]||(e[5]=l=>y.value=!1)},{default:a(()=>e[13]||(e[13]=[d(" Cancelar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),m.value?(g(),q(P,{key:0},{default:a(()=>[t(fe)]),_:1})):ve("",!0)],64)}}},Ve=re(Ee,[["__scopeId","data-v-16ba387a"]]),Be={__name:"gestion",setup($){return(w,k)=>(g(),q(_e(Ve)))}};export{Be as default};
